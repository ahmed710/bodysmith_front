<div class="flex flex-col flex-auto min-w-0">
    <!-- Header -->
    <div
        class="flex flex-col sm:flex-row flex-0 sm:items-center sm:justify-between p-6 pb-22 sm:pt-12 sm:pb-28 sm:px-10 bg-default dark:bg-transparent"
    >
        <div class="flex-1 min-w-0">
            <!-- Breadcrumbs -->
            <div>
                <div class="hidden sm:flex flex-wrap items-center font-medium">
                    <div>
                        <a class="whitespace-nowrap text-primary-500"
                            >Projects</a
                        >
                    </div>
                    <div class="flex items-center ml-1 whitespace-nowrap">
                        <mat-icon
                            class="icon-size-5 text-secondary"
                            [svgIcon]="'heroicons_solid:chevron-right'"
                        ></mat-icon>
                        <a class="ml-1 text-primary-500">Weekend Project</a>
                    </div>
                    <div class="flex items-center ml-1 whitespace-nowrap">
                        <mat-icon
                            class="icon-size-5 text-secondary"
                            [svgIcon]="'heroicons_solid:chevron-right'"
                        ></mat-icon>
                        <span class="ml-1 text-secondary">Overview</span>
                    </div>
                </div>
                <div class="flex sm:hidden">
                    <a
                        class="inline-flex items-center -ml-1.5 text-secondary font-medium"
                        [routerLink]="'./..'"
                    >
                        <mat-icon
                            class="icon-size-5 text-secondary"
                            [svgIcon]="'heroicons_solid:chevron-left'"
                        ></mat-icon>
                        <span class="ml-1">Back</span>
                    </a>
                </div>
            </div>
            <!-- Title -->
            <div class="mt-2">
                <h2
                    class="text-3xl md:text-4xl font-extrabold tracking-tight leading-7 sm:leading-10 truncate"
                >
                    Restaurant Management
                </h2>
            </div>
        </div>
    </div>

    <!-- Main -->
    <div class="flex-auto -mt-16 p-6 sm:p-10 rounded-t-2xl shadow bg-card">
        <div class="space-y-6">
            <!-- Add Restaurant Form -->
            <form
                [formGroup]="restaurantForm"
                (ngSubmit)="createOrUpdateRestaurant()"
            >
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <!-- Restaurant Name -->
                    <mat-form-field appearance="fill">
                        <mat-label>Restaurant Name</mat-label>
                        <input matInput formControlName="nomRestaurant" />
                        <mat-error
                            *ngIf="restaurantForm.get('nomRestaurant').invalid"
                        >
                            <small
                                *ngIf="restaurantForm.get('nomRestaurant').errors?.['required']"
                            >
                                Restaurant Name is required
                            </small>
                            <small
                                *ngIf="restaurantForm.get('nomRestaurant').errors?.['maxlength']"
                            >
                                Restaurant Name cannot exceed 30 characters
                            </small>
                        </mat-error>
                    </mat-form-field>

                    <!-- Restaurant Address -->
                    <mat-form-field appearance="fill">
                        <mat-label>Restaurant Address</mat-label>
                        <input matInput formControlName="adresseRestaurant" />
                        <geoapify-geocoder-autocomplete
                            (placeSelect)="placeSelected($event)"
                            [value]="
                                restaurantForm.get('adresseRestaurant')?.value
                            "
                        ></geoapify-geocoder-autocomplete>
                        <mat-error
                            *ngIf="
                                restaurantForm.get('adresseRestaurant').invalid
                            "
                        >
                            <small
                                *ngIf="restaurantForm.get('adresseRestaurant').errors?.['required']"
                            >
                                Restaurant Address is required
                            </small>
                        </mat-error>
                    </mat-form-field>

                    <!-- Restaurant Image -->
                    <mat-form-field appearance="fill">
                        <mat-label>Restaurant Image</mat-label>
                        <ngx-mat-file-input
                            formControlName="imageRestaurant"
                            (change)="onFileSelected($event)"
                        ></ngx-mat-file-input>
                    </mat-form-field>

                    <!-- Categorie Restaurant -->
                    <mat-form-field appearance="fill">
                        <mat-label>Categorie Restaurant</mat-label>
                        <mat-select
                            formControlName="categorieRestaurant"
                            multiple
                        >
                            <mat-option
                                *ngFor="let category of categorieRestaurants"
                                [value]="category._id"
                            >
                                {{ category.libelle }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <!-- Plats -->
                    <mat-form-field appearance="fill">
                        <mat-label>Plats</mat-label>
                        <mat-select formControlName="plats" multiple>
                            <mat-option
                                *ngFor="let plat of plats"
                                [value]="plat._id"
                            >
                                {{ plat.nomPlat }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-start">
                    <button
                        mat-raised-button
                        color="primary"
                        type="submit"
                        [disabled]="restaurantForm.invalid"
                    >
                        {{ isEditing ? "Update" : "Create" }}
                    </button>
                    <button
                        mat-raised-button
                        type="button"
                        *ngIf="isEditing"
                        (click)="cancelEdit()"
                        class="ml-4"
                    >
                        Cancel
                    </button>
                </div>
            </form>

            <!-- Search Input and Button -->
            <div class="flex items-center mb-4">
                <mat-form-field appearance="fill" class="flex-auto">
                    <mat-label>Search by Address</mat-label>
                    <input
                        matInput
                        type="text"
                        #searchString
                        (input)="searchRestaurants(searchString.value)"
                    />
                </mat-form-field>
                <button
                    mat-raised-button
                    type="button"
                    (click)="clearSearch(searchString)"
                    class="ml-4"
                >
                    Clear Search
                </button>
            </div>

            <!-- Table of Restaurants -->
            <div>
                <table mat-table [dataSource]="restaurants">
                    <!-- Define your table columns -->
                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef>Name</th>
                        <td mat-cell *matCellDef="let restaurant">
                            {{ restaurant.nomRestaurant }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="address">
                        <th mat-header-cell *matHeaderCellDef>Address</th>
                        <td mat-cell *matCellDef="let restaurant">
                            {{ restaurant.adresseRestaurant }}
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="categories">
                        <th mat-header-cell *matHeaderCellDef>Categories</th>
                        <td mat-cell *matCellDef="let restaurant">
                            <span
                                *ngFor="
                                    let category of restaurant.categorieRestaurant
                                "
                            >
                                {{ category.libelle }},
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="plats">
                        <th mat-header-cell *matHeaderCellDef>Plats</th>
                        <td mat-cell *matCellDef="let restaurant">
                            <span *ngFor="let plat of restaurant.plats">
                                {{ plat.nomPlat }},
                            </span>
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef>Actions</th>
                        <td mat-cell *matCellDef="let restaurant">
                            <button
                                mat-icon-button
                                (click)="editRestaurant(restaurant)"
                            >
                                <mat-icon>edit</mat-icon>
                            </button>
                            <button
                                mat-icon-button
                                color="warn"
                                (click)="deleteRestaurant(restaurant._id)"
                            >
                                <mat-icon>delete</mat-icon>
                            </button>
                        </td>
                    </ng-container>

                    <!-- Table rows -->
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr
                        mat-row
                        *matRowDef="let row; columns: displayedColumns"
                    ></tr>
                </table>
            </div>
        </div>
    </div>
</div>
